steps:
  - task: DownloadPipelineArtifact@2
    inputs:
      buildType: 'current'
      targetPath: '$(Build.SourcesDirectory)/.build'
      artifactName: drop
      itemPattern: |
        drop/linux/server/**

  - script: |
      set -e
      for f in $(Build.SourcesDirectory)/.build/linux/server/*.tar.gz
      do
        foldername=${f%".tar.gz"}
        foldername=${foldername#"$(Build.SourcesDirectory)/.build/linux/server/"}
        mkdir -p $(agent.builddirectory)/${foldername}
        tar -C $(agent.builddirectory)/${foldername} -zxvf $f
      done
    displayName: Unzip artifacts

  - script: |
      set -e
      ./build/azure-pipelines/docker/createDrop.sh
    displayName: Create Drop

  - task: PublishBuildArtifacts@1
    displayName: 'Publish Artifact: drop'

  - task: ms.vss-governance-buildtask.governance-build-task-component-detection.ComponentGovernanceComponentDetection@0
    displayName: 'Component Detection'
    inputs:
      failOnAlert: true
